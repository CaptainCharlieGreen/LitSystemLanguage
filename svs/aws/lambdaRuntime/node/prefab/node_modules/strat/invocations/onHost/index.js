module.exports = function (config) {
  return async function (arg) {
    var fn;
    try {
      fn = require(`../../../../${config.functionName}`);
    } catch (e) {
      throw `Failed to load function ${config.functionName}: ${e}`;
    }

    if (config.shouldntWrap) {
      return fn(arg, config.declaration);
    }

    try {
      const result = await fn(arg.data, config.declaration);
      return {
        data: result
      };
    } catch (e) {
      return {
        componentRejection: e
      };
    }
  };
};
