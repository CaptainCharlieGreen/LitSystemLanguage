const stackTrace = require('stack-trace');
const domoGetter = require('../../stratHijack');
const stdPath = require('path');

module.exports = {
  getResolver: function () {
    return domoGetter(getCallerService(stackTrace.get()));
  },
  getHijack: function () {
    return domoGetter;
  }
}

function getCallerService (stack) {
  let relevantStack = stack.slice(1);

  return relevantStack.map(frame => {
    const file = frame.getFileName();
    if (file === null) return;
    const fileTokens = file.split(stdPath.sep);
    return fileTokens[fileTokens.length - 2].split('.')[0];
  })[0];
};
